import os
from pptx import Presentation
from pptx.util import Cm, Pt
from pptx.dml.color import RGBColor

# For one image/slide
def generate_title(filename):  # filename comes from the loop in create_ppt_from_images for files meeting the conditions
    name_without_ext = os.path.splitext(filename)[0]  # Can also use method chaining, os.path.splitext separates filename and extension (.png), [0] extracts only the filename
    parts = name_without_ext.split('_')  # Split the path by "_"
    if len(parts) >= 3:  # The file is the target if parts > 3
        return f"{parts[0]}_{parts[2]}Theme"  # The first return will exit the function
    return name_without_ext  # If parts <= 3 then return original

# For one image/slide
def add_image_slide(prs, image_path):  # Main target: create a blank slide then add png, title
    blank_slide_layout = prs.slide_layouts[6]  # Use blank theme (default 7th page is blank)
    slide = prs.slides.add_slide(blank_slide_layout)  # Add a new slide (slides.add_slide)
    
    # Set image size and position
    width = height = Cm(18)  # 18 cm
    left = Cm(8.23)  # Horizontal position 8.23 cm, from top-left
    top = Cm(2)      # Vertical position 2 cm, from top-left
    
    # Add image and set its size and position
    pic = slide.shapes.add_picture(image_path, left, top, width, height)  # slide.shapes.add_picture adds specified image (path, size, and position)
    
    # Add title textbox (update position and size)
    title_left = Cm(1.72)    # Horizontal position 1.72 cm, from top-left
    title_top = Cm(1.05)     # Vertical position 1.05 cm, from top-left
    title_width = Cm(31.01)  # Width 31.01 cm
    title_height = Cm(1.92)  # Height 1.92 cm
    
    title_shape = slide.shapes.add_textbox(title_left, title_top, title_width, title_height)  # add_textbox adds a blank box (size and drawing)
    title_frame = title_shape.text_frame  # Set textbox properties
    title_frame.word_wrap = True  # Auto word wrap in the box
    
    p = title_frame.paragraphs[0]  # First paragraph ([0]) in the textbox, basically there's only the first paragraph when initially set
    p.text = generate_title(os.path.basename(image_path))  # Generate title, return the last part of the path string (i.e., filename with extension)
    p.alignment = 1  # Center alignment
    
    # Set title format
    font = p.font  # The following are all font property settings
    font.name = 'Microsoft JhengHei'
    font.size = Pt(40)
    font.color.rgb = RGBColor(0, 0, 0)  # Black

def create_ppt_from_images(image_folder, output_ppt):  # This def is about creating a ppt and excluding the png which is not wordcloud 
    
    prs = Presentation()  # Create new ppt object
    # Set slide size to standard 16:9
    prs.slide_width = Cm(33.867)  # 16:9 width
    prs.slide_height = Cm(19.05)  # 16:9 height
    
    for filename in os.listdir(image_folder):  # os.listdir() will return a list of all the files in the folder (only filename)
        if filename.lower().endswith('.png') and 'Theme Difference' not in filename:  # Setting the condition of target png, 1.end = "png" after convert to lowercase 2.'Theme Difference' not in filename
            image_path = os.path.join(image_folder, filename)  # If the file is target, join path and name (using function os.path.join)
            add_image_slide(prs, image_path)  # Connect to the next def - add_image_slide (every file iterate, hence it will pass every add_image_slide and generate_title)
    prs.save(output_ppt)

# Target file
image_folder = r"path"
output_ppt = r"\output_presentation.pptx"

create_ppt_from_images(image_folder, output_ppt)

print(f"PowerPoint has been generated: {output_ppt}")